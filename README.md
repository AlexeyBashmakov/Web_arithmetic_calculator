# Web_arithmetic_calculator
## Распределенный вычислитель арифметических выражений
Веб-сервис по расчёту арифметических выражений. Для расчёта каждого выражения оное преобразуется в обратную польскую нотацию, которая позволяет производить расчёты не связанных действий параллельно.<br>
Создан на Go как один из этапов обучения в Yandex лицее.<br>
Идея вычислителя:<br>
Пользователь хочет считать арифметические выражения. Он вводит строку `2 + 2 * 2` и хочет получить в ответ `6`.<br>
Но наши операции сложения и умножения (также деления и вычитания) выполняются "очень-очень" долго.<br>
Поэтому вариант, при котором пользователь делает http-запрос и получает в качетсве ответа результат, невозможна.<br>
Более того, вычисление каждой такой операции в нашей "альтернативной реальности" занимает "гигантские" вычислительные мощности.<br>
Соответственно, каждое действие мы должны уметь выполнять отдельно и масштабировать эту систему можем добавлением вычислительных мощностей в нашу систему в виде новых "машин".<br>
Поэтому пользователь может с какой-то периодичностью уточнять у сервера "не посчиталость ли выражение"?<br>
Если выражение наконец будет вычислено - то он получит результат.<br>
Некоторые части арфиметического выражения мы вычисляем параллельно.

Вычислитель должен состоять из двух частей: front-end'а и back-end'а.<br>

Вычислитель умеет считать арифметические выражения содержащие четыре арифметические операции (+, -, *, /) и скобки.
## Установка проекта
Для установки проекта на локальный компьютер возможны два варианта:
1) склонировать репозиторий командой<br>
git clone https://github.com/AlexeyBashmakov/Web_arithmetic_calculator.git<br>
появится папка `Web_arithmetic_calculator`.
2) скачать проект с репозитория как архив zip и разархивировать, появится папка `Web_arithmetic_calculator`.

Далее работа с проектом в обоих вариантах установки совпадает, но различается в зависимости от операционной системы.<br>
В директории `Web_arithmetic_calculator/calculator/cmd/` находится файл `main.go`, который является
точкой входа в приложение. Также здесь находятся файлы с расширениями `.bat` и `.sh`. Первые используются для работы с приложением в ОС Windows, вторые - в ОС Linux.
### ОС Windows
Для того чтобы проект можно было запустить на исполнение необходимо в папке `Web_arithmetic_calculator/calculator/cmd/`
запустить скрипт `build.bat` при этом go соберёт исполняемый файл `main.exe`<br>
Для запуска проекта и работы с ним потребуются две консоли (запустить их можно с помощью комбинаций клавиш Win+R и, 
в появившемся окне "Выполнить", в строке "Открыть" ввести `cmd`).<br> 
В одной консоли, в директории `Web_arithmetic_calculator/calculator/cmd/`, запускаем скрипт `run.bat`. 
(В этом скрипте устанавливаются переменные окружения необходимые для работы программы.) 
При старте серверной части в консоли отобразятся приветствие Чебурашки и информационные сообщения о 
старте вычислительных горутин агента. После старта сервер ждет запросов. Для завершения 
работы сервера в консоли достаточно нажать комбинацию клавиш `Ctrl+C`.<br>
В другой консоли, в той же директории, предлагается запуск скриптов (для первичного, демонстрационного 
ознакомления) в следующей последовательности:
 - `calculate.bat`
 - `expression_id.bat`
 - `expression.bat`

Скрипт `calculate.bat` содержит набор арифметических выражений для передачи серверу с помощью утилиты `curl`.<br>
Скрипт `expression_id.bat` содержит запрос к серверу о статусе выполнения отдельной задачи, также с помощью утилиты `curl`..<br>
Скрипт `expressions.bat` содержит запрос к серверу о статусе выполнения всех задач переданных серверу, также с помощью утилиты `curl`.
### ОС Linux
Для того чтобы проект можно было запустить на исполнение необходимо в папке `Web_arithmetic_calculator/calculator/cmd/`
запустить скрипт `build.sh` при этом go соберёт исполняемый файл `main`<br>
Для запуска проекта и работы с ним потребуются две консоли.<br> 
В одной консоли, в директории `Web_arithmetic_calculator/calculator/cmd/`, запускаем скрипт `run.sh`. 
(В этом скрипте устанавливаются переменные окружения необходимые для работы программы.) 
При старте серверной части в консоли отобразятся приветствие Чебурашки и информационные сообщения о 
старте вычислительных горутин агента. После старта сервер ждет запросов. Для завершения 
работы сервера в консоли достаточно нажать комбинацию клавиш `Ctrl+C`.<br>
В другой консоли, в той же директории, предлагается запуск скриптов (для первичного, демонстрационного 
ознакомления) в следующей последовательности:
 - `calculate.sh`
 - `expression_id.sh`
 - `expression.sh`

Скрипт `calculate.sh` содержит набор арифметических выражений для передачи серверу с помощью утилиты `wget`.<br>
Скрипт `expression_id.sh` содержит запрос к серверу о статусе выполнения отдельной задачи, также с помощью утилиты `wget`..<br>
Скрипт `expressions.sh` содержит запрос к серверу о статусе выполнения всех задач переданных серверу, также с помощью утилиты `wget`.
## Примеры использования
Файлы `calculate.bat` и `calculate.sh` содержат по заданию намеренно написанному с ошибкой для демонстрации обработки сервером синтаксически неправильных выражений:<br>
`--data "{\"id\": 2, \"expression\": \"1-1*3+3*\"}"`<br>
здесь выражение завершается символом операции и считается неправильным (невалидным). Также эти файлы содержат по заданию показывающему ограниченность текущего алгортима 
параллельных вычислений задач:<br>
`--data "{\"id\": 7, \"expression\": \"(8+2*5)/(1+3*2-4)\"}"`<br>
Текущий алгоритм расчёта возвращает результат этого выражения 2, а правильный ответ - 6.
### ОС Windows
Запросы к серверу можно осуществлять с помощью утилиты `curl`, которая входит в состав ОС Windows (по крайней мере до версии 10, включительно).
1) Постановка задачи серверу - добавление вычисления арифметического выражения<br>
`curl --location "http://localhost:8080/api/v1/calculate" --header "Content-Type: application/json" --data "{\"id\": 1, \"expression\": \"1-1*3+3*9\"}" -v`<br>
Объяснение параметров:<br>
--location - адрес, к которому отправить запрос<br>
--header - заголовок HTTP-запроса<br>
--data - данные, которые передаются с запросом<br>
2) Получение списка выражений<br>
`curl --location "http://localhost:8080/api/v1/expressions" -v`
3) Получение выражения по его идентификатору<br>
`curl --location "http://localhost:8080/api/v1/expressions/:8" -v`<br>
Здесь после двоеточия в конце строки адреса указывается идентификатор задачи (в данном случае 8), статус которой нам интересен.

### ОС Linux
В Linux'е нет, по-умолчанию, curl'а, поэтому для демонстрации работы проекта можно использовать wget, которая включается почти в каждый дистрибутив данной ОС.
1) Постановка задачи серверу - добавление вычисления арифметического выражения<br>
`wget http://localhost:8080/api/v1/calculate --header="Content-Type: application/json" --post-data="{\"id\": 3, \"expression\": \"3+4\"}" -O -`<br>
Объяснение параметров:<br>
адрес, к которому отправляется запрос, располагается сразу за именем утилиты, поэтому не выделяется никаким специальным параметром<br>
--header - заголовок HTTP-запроса<br>
--post-data - данные, которые передаются с запросом<br>
-O - полученную информацию выводить в консоль
2) Получение списка выражений<br>
`wget http://localhost:8080/api/v1/expressions -O -`
3) Получение выражения по его идентификатору<br>
`wget http://localhost:8080/api/v1/expressions/:3 -O -`<br>
Здесь после двоеточия в конце строки адреса указывается идентификатор задачи (в данном случае 3), статус которой нам интересен.