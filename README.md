# Web_arithmetic_calculator
## Распределенный вычислитель арифметических выражений
Веб-сервис по расчёту арифметических выражений. Каждая арифметическая операция занимает "гигантские" вычислительные мощности, что моделируется с помощью времени выполнения операций, которые задаются переменными среды в милисекундах.
Для расчёта каждого выражения оное преобразуется в обратную польскую нотацию, которая позволяет производить расчёты не связанных действий параллельно.<br>
Вычислитель умеет считать арифметические выражения содержащие четыре арифметические операции (+, -, *, /) и скобки.<br>
Создан на Go во время обучения в Yandex лицее.<br>
Вычислитель состоит из серверной и клиентской частей.

## Установка проекта
Для установки проекта на локальный компьютер возможны два варианта:
1) склонировать репозиторий командой<br>
git clone https://github.com/AlexeyBashmakov/Web_arithmetic_calculator.git<br>
появится папка `Web_arithmetic_calculator`.
2) скачать проект с репозитория как архив zip и разархивировать, появится папка `Web_arithmetic_calculator`.

Далее работа с проектом в обоих вариантах установки совпадает, но различается в зависимости от операционной системы.<br>
В директории `Web_arithmetic_calculator/calculator/bin/` находятся файлы с расширениями `.bat` и `.sh`. Первые используются для работы с приложением в ОС Windows, вторые - в ОС Linux.
### ОС Windows
Для того чтобы проект можно было запустить на исполнение необходимо в папке `Web_arithmetic_calculator/calculator/bin/`
запустить скрипт `build.bat` при этом go соберёт исполняемый файл `main.exe` и поместит его в этой же папке.<br>
Для запуска серверной части проекта потребуется консоль (или терминал, запустить его можно с помощью комбинаций клавиш Win+R и, 
в появившемся окне "Выполнить", в строке "Открыть" ввести `cmd`).<br> 
В консоли, в директории `Web_arithmetic_calculator/calculator/bin/`, запускаем скрипт `run.bat`. 
(В этом скрипте устанавливаются переменные окружения необходимые для работы программы.) 
При старте серверной части в консоли отобразятся информационные сообщения. После старта сервер ждет запросов. Для завершения 
работы сервера в консоли достаточно нажать комбинацию клавиш `Ctrl+C`.<br>

### ОС Linux
Для того чтобы проект можно было запустить на исполнение необходимо в папке `Web_arithmetic_calculator/calculator/bin/`
запустить скрипт `build.sh` при этом go соберёт исполняемый файл `main` и поместит его в этой же папке.<br>
Для запуска серверной части проекта потребуются консоль (терминал). В консоли, в директории `Web_arithmetic_calculator/calculator/bin/`, запускаем скрипт `run.sh`. 
(В этом скрипте устанавливаются переменные окружения необходимые для работы программы.) 
При старте серверной части в консоли отобразятся информационные сообщения. После старта сервер ждет запросов. Для завершения 
работы сервера в консоли достаточно нажать комбинацию клавиш `Ctrl+C`.

## Зависимости
Версия Go не ниже 1.22.4, т.к. используются средства маршрутизации, появившиеся в стандартной библиотеке с указанной версии.

## Примеры использования
После запуска серверной части можно либо с помощью браузера получить доступ к сервису, либо из консоли проверить работу проекта.
### Браузер
В новой вкладке (или новом окне) браузера, в строке адреса введите<br>
`http://localhost:8080`<br>
или
`http://127.0.0.1:8080`<br>
Появится форма для ввода имени и пароля пользователя. Если данный пользователь в системе не зарегистрирован, то при нажатии на кнопку `Войти` появится сообщение, что пользователь не зарегистрирован.
Тогда надо перейти по ссылке в правом нижнем углу формы к регистрации пользователя. После ввода регистрационных данных пользователь будет перенаправлен в свой личный кабинет сервиса. (Если ввести 
имя пользователя кириллицей, то в личном кабинете, в шапке имя пользователя отобразится в виде %D%B...)<br>
Страница личного кабинета пользователя разделена на 4 части:
1. шапка - здесь указано имя пользователя
2. левый столбец - здесь можно задать сервису выражение для вычисления, например: `(5/2+7.5)*10`
3. средний столбец - здесь можно получить информацию о выражении:
   - идентификатор (который был присвоен при задании сервису выражения)
   - само выражение
   - статус: в очереди, вычисляется или завершено
   - результат, у всех не завершённых выражений результат = 0, даже если это правильный ответ
4. правый столбец - таблица всех выражений пользователя.

При взаимодействии пользователя с сервисом первый отправляет в качестве идентификационных данных свой JWT-токен. Этот токен первый раз генерируется при регистрации пользователя, 
потом каждый раз после истечения времени жизни токена и входа пользователя в сервис по имени и паролю. Поэтому когда заканчивается время жизни токена, то пользователь из своего личного кабинета 
перенаправляется на страницу входа в сервис.

Файлы `calculate.bat` и `calculate.sh` содержат по заданию намеренно написанному с ошибкой для демонстрации обработки сервером синтаксически неправильных выражений:<br>
`--data "{\"id\": 2, \"expression\": \"1-1*3+3*\"}"`<br>
здесь выражение завершается символом операции и считается неправильным (невалидным). Также эти файлы содержат по заданию показывающему ограниченность текущего алгортима 
параллельных вычислений задач:<br>
`--data "{\"id\": 7, \"expression\": \"(8+2*5)/(1+3*2-4)\"}"`<br>
Текущий алгоритм расчёта возвращает результат этого выражения 2, а правильный ответ - 6.
### ОС Windows

В другой консоли, в той же директории, предлагается запуск скриптов (для первичного, демонстрационного 
ознакомления) в следующей последовательности:
 - `calculate.bat`
 - `expression_id.bat`
 - `expression.bat`

Скрипт `calculate.bat` содержит набор арифметических выражений для передачи серверу с помощью утилиты `curl`.<br>
Скрипт `expression_id.bat` содержит запрос к серверу о статусе выполнения отдельной задачи, также с помощью утилиты `curl`..<br>
Скрипт `expressions.bat` содержит запрос к серверу о статусе выполнения всех задач переданных серверу, также с помощью утилиты `curl`.
Запросы к серверу можно осуществлять с помощью утилиты `curl`, которая входит в состав ОС Windows (по крайней мере до версии 10, включительно).
1) Постановка задачи серверу - добавление вычисления арифметического выражения<br>
`curl --location "http://localhost:8080/api/v1/calculate" --header "Content-Type: application/json" --data "{\"id\": 1, \"expression\": \"1-1*3+3*9\"}" -v`<br>
Объяснение параметров:<br>
--location - адрес, к которому отправить запрос<br>
--header - заголовок HTTP-запроса<br>
--data - данные, которые передаются с запросом<br>
2) Получение списка выражений<br>
`curl --location "http://localhost:8080/api/v1/expressions" -v`
3) Получение выражения по его идентификатору<br>
`curl --location "http://localhost:8080/api/v1/expressions/:8" -v`<br>
Здесь после двоеточия в конце строки адреса указывается идентификатор задачи (в данном случае 8), статус которой нам интересен.

### ОС Linux
В другой консоли, в той же директории, предлагается запуск скриптов (для первичного, демонстрационного 
ознакомления) в следующей последовательности:
 - `calculate.sh`
 - `expression_id.sh`
 - `expression.sh`

Скрипт `calculate.sh` содержит набор арифметических выражений для передачи серверу с помощью утилиты `wget`.<br>
Скрипт `expression_id.sh` содержит запрос к серверу о статусе выполнения отдельной задачи, также с помощью утилиты `wget`..<br>
Скрипт `expressions.sh` содержит запрос к серверу о статусе выполнения всех задач переданных серверу, также с помощью утилиты `wget`.
В Linux'е нет, по-умолчанию, curl'а, поэтому для демонстрации работы проекта можно использовать wget, которая включается почти в каждый дистрибутив данной ОС.
1) Постановка задачи серверу - добавление вычисления арифметического выражения<br>
`wget http://localhost:8080/api/v1/calculate --header="Content-Type: application/json" --post-data="{\"id\": 3, \"expression\": \"3+4\"}" -O -`<br>
Объяснение параметров:<br>
адрес, к которому отправляется запрос, располагается сразу за именем утилиты, поэтому не выделяется никаким специальным параметром<br>
--header - заголовок HTTP-запроса<br>
--post-data - данные, которые передаются с запросом<br>
-O - полученную информацию выводить в консоль
2) Получение списка выражений<br>
`wget http://localhost:8080/api/v1/expressions -O -`
3) Получение выражения по его идентификатору<br>
`wget http://localhost:8080/api/v1/expressions/:3 -O -`<br>
Здесь после двоеточия в конце строки адреса указывается идентификатор задачи (в данном случае 3), статус которой нам интересен.
